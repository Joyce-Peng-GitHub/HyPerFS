# 开发日志

## 2025/11/27

和朋友讨论了一下构想，向双子座咨询了可行性。

## 2025/12/08

前几天一直在写作业和搞CACC的事情，今天终于可以开始搞了。

本来预备在WSL下写，这个IDEA搞半天没搞好，登不上GitHub，不得不转回Windows。

向双子座咨询了相关的技术路线，列出功能树，制定规划。

初始化项目，学习Maven用法，配置环境。

## 2025/12/09

成功用Netty写了一个简单的HTTP服务端，可以对浏览器的请求作出应答。尚未实现实际的功能，只是简单地返回收到的请求。

## 2025/12/10

导入SQLite依赖。

设计数据库结构。

编写保存数据库信息的实体类，之后读写数据库的结果就保存到这些类里面。

## 2025/12/17

部分重构，增加代码复用。

实现了文件保存逻辑。还没有加数据库操作。

## 2025/12/18

引入Hikari依赖，用于维护连接池。

实现数据库的创建。实现了`file_storage`表的相关操作。

## 2025/12/22

实现了`file_meta`的部分逻辑。

## 2025/12/24

实现列表功能。

实现创建文件夹功能。

有个问题：上传文件时，如果在同一个目录下上传相同名称的文件，此时`file_storage`中`ref_cnt`会自增，但插入`file_meta`表时会因为违反`UNIQUE CONSTRAINT`而抛出`SQLException`，这会导致`ref_cnt`与实际的引用数不匹配。

重名警告应该交给前端处理。服务器应当直接当作替换来处理。

另外目前`/list`回传的JSON还很朴素，可以被注入攻击，也许会祸害前端。（真能吗？）

还有`mv`、`cp`要做。

## 2025/12/25

为了解决昨天发现的这个问题，我应当将数据库操作再抽象出一层。DAO类只管读写，引用计数甚么的逻辑应该由服务层来处理。然后再把文件服务抽象出一层。

这就是一开始没设计好的下场。但是确实之前没有经验。做大作业的意义就在于此罢。

重新设计一下。

## 2025/12/28

重新设计。

## 2025/12/31

重新设计。

## 2026/01/01

终于设计好了。用AI根据计划重构代码。看起来它做得很不错，比我强太多。

Vibe coding真牛逼，AI真好用。我要失业了。

## 2026/01/02

Vibe coding添加对文件夹移动、重命名、复制的支持。禁止涉及同名文件夹覆写的复制、移动、重命名，毕竟连百度网盘这种大型商业软件（虽然是一坨屎）都不支持这种复杂的合并操作。

目前有1400行左右，可以再加点功能。考虑做个注册登录鉴权。另外应当做一些自动化测试，此前都是我手动测试功能，没办法模拟多用户同时操作的并发情况。

实现了断点续传。略微优化。

## 2026/01/03

让AI支持WebDAV协议。但我发现凡是文件名带J或M的文件上传都会报解码失败，说是含有非法字符，令我怀疑人生。我直接点到抛出异常的地方阅读Netty源码，才发现是他这个库有严重的bug，自以为是地用位运算技巧判特殊字符，但是对M和J都会误判。更新Netty版本后解决，我看见新版本回退为了普通的`switch`。如此这么严重的bug怎么能发布的？我真服了，浪费我差不多三个小时，害人不浅。

支持了WebDAV协议。

优化性能。优化前端页面。

引用计数为0时删除物理文件。

优化前端页面。本来想让AI做个像Windows File Explorer那样的，调教半天没有搞出来，遂放弃。

## 2026/01/04

添加用于打包的配置。

增加对选择端口的支持。

增加安全关闭的支持。

优化前端页面，增加文件树。

编写设计文档。
